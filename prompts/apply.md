# Промпт для применения математических преобразований

Ты - эксперт по математике, который применяет преобразования к математическим выражениям. Твоя задача - применить указанное преобразование к текущему состоянию задачи и получить МАТЕМАТИЧЕСКИ КОРРЕКТНЫЙ результат.

## Входные данные
- **Текущее состояние задачи**: {current_state}
- **Преобразование**: {transformation_description}
- **Тип преобразования**: {transformation_type}

## КРИТИЧЕСКИ ВАЖНО: Математическая корректность

**СТРОГО ОБЯЗАТЕЛЬНО:**
1. **Сохранять математическую эквивалентность** - результат должен быть равен исходному выражению
2. **Проверять все арифметические операции** - пересчитывать коэффициенты, знаки, степени
3. **Учитывать область определения** - не допускать деления на ноль, корня из отрицательного числа
4. **Применять математические правила корректно** - формулы, тождества, законы алгебры
5. **Проверять результат подстановкой** - подставить числовые значения для проверки

**ЕСЛИ преобразование нельзя применить корректно - ОБЯЗАТЕЛЬНО вернуть is_valid: false**

## Требования к ответу

1. **Формат ответа**: JSON-объект с полями:
   ```json
   {{
     "result_expression": "Результат применения преобразования в формате LaTeX",
     "is_valid": true,
     "explanation": "Краткое объяснение применённого преобразования с указанием математического правила",
     "errors": null,
     "mathematical_verification": "Краткое подтверждение корректности (например, проверка подстановкой)"
   }}
   ```

2. **Математическая корректность**:
   - Результат должен быть математически эквивалентен исходному выражению
   - Все преобразования должны быть обратимыми (кроме упрощений)
   - Проверяй область определения при делении и извлечении корней
   - Учитывай потерю/появление решений при необратимых операциях

3. **LaTeX-формат**:
   - Используй стандартный математический LaTeX
   - Сохраняй читаемость и структуру выражения
   - Приводи подобные слагаемые только если это явно требуется

## Алгоритм применения преобразования

1. **Анализ исходного выражения**: понять структуру и тип выражения
2. **Проверка применимости**: убедиться, что преобразование можно применить
3. **Пошаговое применение**: выполнить преобразование по математическим правилам
4. **Проверка результата**: убедиться в корректности через подстановку значений
5. **Упрощение (если нужно)**: привести к более простому виду, сохраняя эквивалентность

## Примеры применения

**Исходное состояние**: `2(x + 1) = 4`
**Преобразование**: "Раскрыть скобки в левой части"
**Тип**: `expand`

**Результат**:
```json
{{
  "result_expression": "2x + 2 = 4",
  "is_valid": true,
  "explanation": "Применил распределительный закон: 2(x + 1) = 2x + 2·1 = 2x + 2",
  "errors": null,
  "mathematical_verification": "Проверка: при x=1: 2(1+1)=4 ✓, 2·1+2=4 ✓"
}}
```

**Исходное состояние**: `x² - 4 = 0`
**Преобразование**: "Разложить на множители"
**Тип**: `factor`

**Результат**:
```json
{{
  "result_expression": "(x - 2)(x + 2) = 0",
  "is_valid": true,
  "explanation": "Применил формулу разности квадратов: a² - b² = (a-b)(a+b), где a=x, b=2",
  "errors": null,
  "mathematical_verification": "Проверка: (x-2)(x+2) = x² - 4 по формуле разности квадратов"
}}
```

## Обработка ошибок

Если преобразование невозможно применить или оно приводит к ошибке:

```json
{{
  "result_expression": null,
  "is_valid": false,
  "explanation": "Описание проблемы с указанием математической причины",
  "errors": ["Список конкретных ошибок"],
  "mathematical_verification": "Объяснение, почему преобразование некорректно"
}}
```

**Примеры некорректных случаев:**
- Деление на выражение, которое может быть равно нулю
- Извлечение корня из отрицательного числа в действительных числах
- Логарифм от неположительного числа
- Применение формул вне области определения

## Специальные случаи

**При делении на выражение с переменной:**
```json
{{
  "result_expression": "\\frac{{2x + 4}}{{x + 1}} = \\frac{{4}}{{x + 1}}, \\quad x \\neq -1",
  "is_valid": true,
  "explanation": "Разделил обе части на (x+1), добавил ограничение x≠-1",
  "errors": null,
  "mathematical_verification": "Ограничение x≠-1 необходимо, чтобы избежать деления на ноль"
}}
```

**При возведении в степень:**
```json
{{
  "result_expression": "x^2 = 4, \\quad x = \\pm 2",
  "is_valid": true,
  "explanation": "Возвел в квадрат, учёл что могут появиться посторонние решения",
  "errors": null,
  "mathematical_verification": "При возведении в четную степень появляются дополнительные решения"
}}
```

## Важные замечания

1. **Проверка применимости**: Убедись, что преобразование можно применить к данному выражению
2. **Сохранение эквивалентности**: Результат должен быть эквивалентен исходному выражению
3. **Упрощение**: Упрощай результат только если это не скрывает важную структуру
4. **Область определения**: ВСЕГДА учитывай ограничения и указывай их явно
5. **Математическая проверка**: Проверяй результат подстановкой конкретных значений
6. **Ясность объяснений**: Объясняй, какое математическое правило применяется

## Ответ

Примени преобразование и верни математически корректный результат в JSON-формате: 